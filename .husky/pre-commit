#!/bin/sh

echo "ğŸ” ì»¤ë°‹ ì „ ê²€ì‚¬ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤..."

# 1. Console ì²´í¬ (console.log, console.error ë“±ì´ ìˆìœ¼ë©´ ì»¤ë°‹ ë°©ì§€)
echo "ğŸ“‹ ì½˜ì†” ë¬¸ì¥ ê²€ì‚¬ ì¤‘..."
CONSOLE_CHECK=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(js|jsx|ts|tsx)$' | while read file; do
  grep -n 'console\.' "$file" 2>/dev/null | sed "s|^|$file:|"
done)

if [ -n "$CONSOLE_CHECK" ]; then
  echo "âŒ ì—ëŸ¬: ìŠ¤í…Œì´ì§•ëœ íŒŒì¼ì—ì„œ console ë¬¸ì¥ì„ ì°¾ì•˜ìŠµë‹ˆë‹¤!"
  echo "ì»¤ë°‹í•˜ê¸° ì „ì— ëª¨ë“  console.log, console.error ë“±ì„ ì œê±°í•´ì£¼ì„¸ìš”."
  echo ""
  echo "ğŸ“ console ë¬¸ì¥ì´ ìˆëŠ” íŒŒì¼ ìœ„ì¹˜:"
  echo "$CONSOLE_CHECK" | head -20
  exit 1
fi

# 2. Lint-staged (ESLint + Prettier)
echo "ğŸ¨ Lint-staged ì‹¤í–‰ ì¤‘..."
npx lint-staged

if [ $? -ne 0 ]; then
  echo "âŒ Lint-staged ê²€ì‚¬ ì‹¤íŒ¨!"
  exit 1
fi

# 3. TypeScript íƒ€ì… ì²´í¬
echo "âœ… TypeScript íƒ€ì… ê²€ì‚¬ ì¤‘..."
npx tsc --noEmit

if [ $? -ne 0 ]; then
  echo "âŒ TypeScript ê²€ì‚¬ ì‹¤íŒ¨!"
  exit 1
fi

echo "âœ¨ ì»¤ë°‹ ì „ ê²€ì‚¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!"
